var Scriptable;(()=>{var e={418:e=>{const t={196:1,197:20,198:7,199:20,200:10,201:26,203:6,204:14,205:13,206:35},a={196:0,197:20,198:50,199:50,200:0,201:50,203:50,204:50,205:50,206:100};function n(e,t){return e.timestamp<t.timestamp?-1:e.timestamp>t.timestamp?1:0}class i{constructor(e,t,a){this.original=e,this.loss=t,this.remaining=a}}function o(e,t){let a=Number((e/100).toFixed(4)),n=[];for(let e=1*t;e<=90*t;e++){let t=Math.floor(e/(a-5e-5));t==Math.ceil(e/(a+5e-5))&&n.push(new i(t,e,t-e))}return n}const s="Natural Recovery";function r(e,t,a){let i=e.filter((e=>"Rehab"!==e.title&&t<1e3*e.timestamp&&1e3*e.timestamp<a)),o=function(e){const t=162001275e4,a=864e5;return t+Math.ceil((e-t)/a)*a}(t);for(;o<a;)i.push({log:-1,title:s,timestamp:o/1e3,data:{points:o>161892e7?20:21}}),o+=864e5;return i.sort(n),i}function l(e,n){let i=n;return e.map((e=>{let n;return n=e.title===s?-Math.min(i,e.data.points):e.title.indexOf("overdose")>=0?Math.round(.5*a[e.data.item]):Math.round(.5*t[e.data.item]),i+=n,{timestamp:e.timestamp,delta:n,points:i,description:e.title}}))}function c(e){return e.map((e=>({timestamp:e.timestamp,delta:null,points:null,description:e.title})))}e.exports={createTableRows:function(e,t){let a=[];for(let n=e.length-1;n>0;n--){let s=e[n],u=e[n-1],d=1e3*s.timestamp,m=1e3*u.timestamp;if(s.timestamp<t[t.length-1].timestamp)continue;let p,h=r(t,d,m);p=100===s.data.addiction?[new i(null,null,0)]:o(s.data.addiction,s.data.rehab_times);let v=o(u.data.addiction,u.data.rehab_times),g=[];for(let e=0;e<p.length;e++)for(let t=0;t<v.length;t++){let a,n;h.length?(a=l(h,p[e].remaining),n=a[a.length-1].points):(a=[],n=p[e].remaining),n==v[t].original&&g.push({previous:p[e],current:v[t],rows:a})}g.length>1&&(console.log("ambiguous solutions:",g,"for rehab:",u),a.length>0&&null!==a[a.length-1].points?(console.log("trying to disambiguate"),g=g.filter((e=>e.previous.remaining==a[a.length-1].points&&e.previous.loss==-a[a.length-1].delta))):console.log("unable to disambiguate"),1==g.length?console.log("succeeded to disambiguate"):console.log("failed to disambiguate")),1==g.length?(a=a.concat(g[0].rows),a.push({timestamp:u.timestamp,delta:-g[0].current.loss,points:g[0].current.remaining,description:`Rehab x${u.data.rehab_times} ${u.data.addiction}%`})):(a=a.concat(c(h)),a.push({timestamp:u.timestamp,delta:null,points:null,description:`Rehab x${u.data.rehab_times} ${u.data.addiction}%`}))}let n,s=r(t,1e3*e[0].timestamp,Date.now());return n=null!=a[a.length-1].points?l(s,a[a.length-1].points):c(s),a=a.concat(n),a}}},239:(e,t,a)=>{const n=a(115),i={4:{name:"DUKE",glyph:"杜"},15:{name:"Leslie",glyph:"莱"},19:{name:"Jimmy",glyph:"吉"},20:{name:"Fernando",glyph:"费"},21:{name:"Tiny",glyph:"小"},17:{name:"Bunny",glyph:"兔"}};e.exports={yata:async function(){const e=await n.get("https://yata.yt/api/v1/loot","json");if(!e)return;const t={};for(const a in e.hosp_out){if(!i[a])continue;const n=e.hosp_out[a];t[a]=Object.assign({},i[a],{hosp_out:n})}return{npcs:t,planned:0}},lzpt:async function(){const e=await n.get("https://api.lzpt.io/loot","json");if(!e)return;const t={};for(const a in e.npcs){if(!i[a])continue;const{hosp_out:n}=e.npcs[a];t[a]=Object.assign({},i[a],{hosp_out:n})}return{npcs:t,planned:e.time.clear}}}},322:(e,t,a)=>{const n=a(238),{get:i}=a(115);console.log("Runtime Version: 20210708");const o=e=>async(t,a="")=>{let n=null;if(config.runsInWidget||config.runsWithSiri){n=new t((config.runsInWidget?args.widgetParameter:args.shortcutParameter)||"");const e=await n.render();Script.setWidget(e),Script.complete()}else{let{act:o,data:s,__arg:r,__size:l}=args.queryParameters;if(n=new t(r||a||""),l&&n.init(l),!o||!n._actions){const t=n._actions;e&&(t.Preview=(e=>async()=>{let t=new Alert;t.title="Preview",t.message="preview widget of different size",t.addAction("Small"),t.addAction("Medium"),t.addAction("Large"),t.addAction("All"),t.addCancelAction("Cancel");let a,n=await t.presentSheet();if(-1!==n){switch(n){case 0:e.widgetFamily="small",a=await e.render(),await a.presentSmall();break;case 1:e.widgetFamily="medium",a=await e.render(),await a.presentMedium();break;case 2:e.widgetFamily="large",a=await e.render(),await a.presentLarge();break;case 3:e.widgetFamily="small",a=await e.render(),await a.presentSmall(),e.widgetFamily="medium",a=await e.render(),await a.presentMedium(),e.widgetFamily="large",a=await e.render(),await a.presentLarge()}return n}})(n)),n.settingsURL&&(t.Settings=(e=>async()=>{let t=new WebView;const a=await e.httpGet(e.settingsURL,!1,!0);await t.loadHTML(a);let n=e.loadSettings(),i=e.defaultSettings();await t.evaluateJavaScript(`window.importSettings(${JSON.stringify(n)}, ${JSON.stringify(i)})`),await t.present();const o=await t.evaluateJavaScript("window.exportSettings()");e.saveSettings(o)})(n)),n.updateURL()&&(t.Update=(e=>async()=>{console.log("check update");const t=e.name,a=`${e.updateURL()}/manifest.json`,n=await i(a,"json").catch((e=>{console.error(`check update failed: ${e}`)}));if(!n)return;if(!n.version)return void console.warn(`no version for ${t}`);const o=new Alert;if(o.message=`current: ${e.version}\nlatest: ${n.version}`,o.addTextField("version",n.version),o.addAction("Update"),o.addCancelAction("Cancel"),-1==await o.presentAlert())return;const s=o.textFieldValue(0);if(0==s.length||s===e.version)return;console.log("download file");const r=`${e.updateURL(s)}/index.js`,l=await i(r).catch((e=>{console.error(`download failed: ${e}`)}));l&&(console.log("write file"),e.FILE_MGR.write(e.FILE_MGR.joinPath(e.FILE_MGR.documentsDirectory(),`${Script.name()}.js`),l),console.log("check update finished"))})(n));const a=new Alert;a.title=`${n.name.toUpperCase()} Widget`,a.message=`v${n.version}`;const o=[];for(const e in t)a.addAction(e),o.push(t[e]);a.addCancelAction("Cancel");const s=await a.presentSheet();if(o[s]){const e=o[s];await e()}return}let c=`action${o.split("-").map((e=>e[0].toUpperCase()+e.substr(1))).join("")}`;if(n[c]&&"function"==typeof n[c]){const e=n[c].bind(n);await e(s)}}},s=o(!1),r=o(!0);e.exports={Base:class{constructor(e=""){this.arg=e,this.name="",this.version="",this.desc="",this.settingsURL="",this._actions={},this.init()}init(e=config.widgetFamily){this.widgetFamily=e,this.SETTING_KEY=this.md5(Script.name()),this.FILE_MGR=FileManager[globalThis.module.filename.includes("Documents/iCloud~")?"iCloud":"local"](),this.settings=this.loadSettings()}registerAction(e,t){this._actions[e]=t.bind(this)}actionUrl(e="",t=""){let a=URLScheme.forRunningScript(),n=`act=${encodeURIComponent(e)}&data=${encodeURIComponent(t)}&__arg=${encodeURIComponent(this.arg)}&__size=${this.widgetFamily}`,i="";return i=a.includes("run?")?`${a}&${n}`:`${a}?${n}`,i}base64Encode(e){return Data.fromString(e).toBase64String()}base64Decode(e){return Data.fromBase64String(e).toRawString()}md5(e){function t(e,t){var a=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(a>>16)<<16|65535&a}function a(e,a,n,i,o,s){return t((r=t(t(a,e),t(i,s)))<<(l=o)|r>>>32-l,n);var r,l}function n(e,t,n,i,o,s,r){return a(t&n|~t&i,e,t,o,s,r)}function i(e,t,n,i,o,s,r){return a(t&i|n&~i,e,t,o,s,r)}function o(e,t,n,i,o,s,r){return a(t^n^i,e,t,o,s,r)}function s(e,t,n,i,o,s,r){return a(n^(t|~i),e,t,o,s,r)}function r(e,a){var r,l,c,u;e[a>>5]|=128<<a%32,e[14+(a+64>>>9<<4)]=a;for(var d=1732584193,m=-271733879,p=-1732584194,h=271733878,v=0;v<e.length;v+=16)d=n(r=d,l=m,c=p,u=h,e[v],7,-680876936),h=n(h,d,m,p,e[v+1],12,-389564586),p=n(p,h,d,m,e[v+2],17,606105819),m=n(m,p,h,d,e[v+3],22,-1044525330),d=n(d,m,p,h,e[v+4],7,-176418897),h=n(h,d,m,p,e[v+5],12,1200080426),p=n(p,h,d,m,e[v+6],17,-1473231341),m=n(m,p,h,d,e[v+7],22,-45705983),d=n(d,m,p,h,e[v+8],7,1770035416),h=n(h,d,m,p,e[v+9],12,-1958414417),p=n(p,h,d,m,e[v+10],17,-42063),m=n(m,p,h,d,e[v+11],22,-1990404162),d=n(d,m,p,h,e[v+12],7,1804603682),h=n(h,d,m,p,e[v+13],12,-40341101),p=n(p,h,d,m,e[v+14],17,-1502002290),d=i(d,m=n(m,p,h,d,e[v+15],22,1236535329),p,h,e[v+1],5,-165796510),h=i(h,d,m,p,e[v+6],9,-1069501632),p=i(p,h,d,m,e[v+11],14,643717713),m=i(m,p,h,d,e[v],20,-373897302),d=i(d,m,p,h,e[v+5],5,-701558691),h=i(h,d,m,p,e[v+10],9,38016083),p=i(p,h,d,m,e[v+15],14,-660478335),m=i(m,p,h,d,e[v+4],20,-405537848),d=i(d,m,p,h,e[v+9],5,568446438),h=i(h,d,m,p,e[v+14],9,-1019803690),p=i(p,h,d,m,e[v+3],14,-187363961),m=i(m,p,h,d,e[v+8],20,1163531501),d=i(d,m,p,h,e[v+13],5,-1444681467),h=i(h,d,m,p,e[v+2],9,-51403784),p=i(p,h,d,m,e[v+7],14,1735328473),d=o(d,m=i(m,p,h,d,e[v+12],20,-1926607734),p,h,e[v+5],4,-378558),h=o(h,d,m,p,e[v+8],11,-2022574463),p=o(p,h,d,m,e[v+11],16,1839030562),m=o(m,p,h,d,e[v+14],23,-35309556),d=o(d,m,p,h,e[v+1],4,-1530992060),h=o(h,d,m,p,e[v+4],11,1272893353),p=o(p,h,d,m,e[v+7],16,-155497632),m=o(m,p,h,d,e[v+10],23,-1094730640),d=o(d,m,p,h,e[v+13],4,681279174),h=o(h,d,m,p,e[v],11,-358537222),p=o(p,h,d,m,e[v+3],16,-722521979),m=o(m,p,h,d,e[v+6],23,76029189),d=o(d,m,p,h,e[v+9],4,-640364487),h=o(h,d,m,p,e[v+12],11,-421815835),p=o(p,h,d,m,e[v+15],16,530742520),d=s(d,m=o(m,p,h,d,e[v+2],23,-995338651),p,h,e[v],6,-198630844),h=s(h,d,m,p,e[v+7],10,1126891415),p=s(p,h,d,m,e[v+14],15,-1416354905),m=s(m,p,h,d,e[v+5],21,-57434055),d=s(d,m,p,h,e[v+12],6,1700485571),h=s(h,d,m,p,e[v+3],10,-1894986606),p=s(p,h,d,m,e[v+10],15,-1051523),m=s(m,p,h,d,e[v+1],21,-2054922799),d=s(d,m,p,h,e[v+8],6,1873313359),h=s(h,d,m,p,e[v+15],10,-30611744),p=s(p,h,d,m,e[v+6],15,-1560198380),m=s(m,p,h,d,e[v+13],21,1309151649),d=s(d,m,p,h,e[v+4],6,-145523070),h=s(h,d,m,p,e[v+11],10,-1120210379),p=s(p,h,d,m,e[v+2],15,718787259),m=s(m,p,h,d,e[v+9],21,-343485551),d=t(d,r),m=t(m,l),p=t(p,c),h=t(h,u);return[d,m,p,h]}function l(e){for(var t="",a=32*e.length,n=0;n<a;n+=8)t+=String.fromCharCode(e[n>>5]>>>n%32&255);return t}function c(e){var t=[];for(t[(e.length>>2)-1]=void 0,n=0;n<t.length;n+=1)t[n]=0;for(var a=8*e.length,n=0;n<a;n+=8)t[n>>5]|=(255&e.charCodeAt(n/8))<<n%32;return t}function u(e){for(var t,a="0123456789abcdef",n="",i=0;i<e.length;i+=1)t=e.charCodeAt(i),n+=a.charAt(t>>>4&15)+a.charAt(15&t);return n}function d(e){return unescape(encodeURIComponent(e))}function m(e){return l(r(c(t=d(e)),8*t.length));var t}return u(m(e))}async httpGet(e,t=!0,a=!1){let n=null;const i=this.md5(e);if(a&&Keychain.contains(i)){let e=Keychain.get(i);return t?JSON.parse(e):e}try{let a=new Request(e);n=await(t?a.loadJSON():a.loadString())}catch(e){}if(!n&&Keychain.contains(i)){let e=Keychain.get(i);return t?JSON.parse(e):e}return Keychain.set(i,t?JSON.stringify(n):n),n}loadSettings(){let e=Object.assign({},n.getJSON(this.SETTING_KEY)),t=Object.assign({},this.defaultSettings());for(const a of Object.keys(t))a in e&&(t[a]=e[a]);for(const e in t){const a="object"==typeof t[e]?t[e].select?.value:t[e];console.log(`${e}: ${a}`)}return t}saveSettings(e){console.log(`save settings: ${JSON.stringify(e)}`),n.setJSON(this.SETTING_KEY,e)}clearSettings(){n.remove(this.SETTING_KEY)}defaultSettings(){}updateURL(){}track(e,t){const a=Device.screenResolution();let n;n=config.runsInWidget?`widget.${this.widgetFamily}`:config.runsWithSiri?"siri":config.runsInApp?"app":config.runsInNotification?"notification":config.runsInActionExtension?"actionExtension":config.runsFromHomeScreen?"homeScreen":"unknown";const i={idsite:1,rec:1,action_name:e,url:`https://widget.tornhub.xyz/${n}`,_id:UUID.string().replaceAll("-","").substring(0,16),rand:Math.floor(1e6*Math.random()),apiv:1,res:`${a.width}x${a.height}`};t&&(i.uid=t),this.version&&(i.dimension1=this.version);const o=Object.keys(i).map((e=>`${e}=${encodeURIComponent(i[e])}`)).join("&");new Request(`https://analytics.tornhub.xyz/matomo.php?${o}`).load()}},Testing:r,Running:s}},115:e=>{e.exports={get:async(e,t)=>{const a=(e=>async t=>{const a=new Request(t);let n;a.timeoutInterval=5,n="json"===e?await a.loadJSON():"string"===e?await a.loadString():await a.load();const{statusCode:i}=a.response;if(200!==i)throw new Error(`Failed to request ${t} with status code ${i}.`);return n})(t);return await a(e).catch((e=>console.warn(`Request Failed Error:${e}`)))}}},238:e=>{e.exports={set(e,t){let a;if("number"==typeof t)a=String(t);else{if("string"!=typeof t)return;a=t}Keychain.set(e,a)},get:e=>Keychain.contains(e)?Keychain.get(e):null,remove(e){Keychain.contains(e)&&Keychain.remove(e)},setJSON(e,t){this.set(e,JSON.stringify(t))},getJSON(e){let t;try{t=JSON.parse(this.get(e))}catch(e){return null}return t}}},891:e=>{e.exports={roundNumber:function(e,t){const a=Math.pow(10,e.toFixed(0).length-t);return Number((Number(e.toFixed(0))/a).toFixed(0))*a},formatNumber:function e(t){return t<0?"-"+e(-t):0==t?"0":t<=1?(100*t).toFixed(2)+"%":t<1e3?""+parseInt(t):t>=1e3&&t<1e6?t/1e3+"k":t>=1e6&&t<1e9?t/1e6+"m":t>=1e9&&t<1e12?t/1e9+"b":t>=1e12&&t<1e15?t/1e12+"t":t>=1e15?"MAX":void 0}}}},t={};function a(n){var i=t[n];if(void 0!==i)return i.exports;var o=t[n]={exports:{}};return e[n](o,o.exports,a),o.exports}a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n={};(()=>{"use strict";a.r(n),a.d(n,{run:()=>G});var e=a(322);const t=a(238),{createTableRows:i}=a(418),{roundNumber:o,formatNumber:s}=a(891),r=a(239),l="Hospital",c="Traveling",u="energy",d="nerve",m="travel",p="racing",h="drug",v="booster",g="medical",f="bank",w="education",x="refills.energy",y="refills.nerve",b="refills.token",k={[m]:"airplane",[h]:"pills.fill",[v]:"shift.fill",[g]:"cross.case.fill",[p]:"car.fill"},S={[m]:"飞",[h]:"药",[v]:"酒",[g]:"医",[p]:"车"},$="RacingStatusWaiting",_=Font.regularSystemFont(14),C=Color.dynamic(new Color("#ececec",.5),new Color("#333333",.5));function T(e,t=2){let a=String(e);for(;a.length<t;)a="0"+a;return a}function R(e,t){return new Date(1e3*(e+t))}function N(e){const t={days:Math.floor(e/60/60/24),hours:Math.floor(e/60/60)%24,minutes:Math.floor(e/60)%60};for(const e in t){const a=t[e];if(a>0)return{unit:e,value:a}}}async function z(e,t){const{identifier:a}=e;await Notification.removePending([a]);let n=new Notification;n.openURL="alook://",n.sound="default",n=Object.assign(n,e),n.setTriggerDate(t),await n.schedule()}const D=70,j=148;class A{constructor(e,t){this.textColor=e,this.backgroundColor=t}}class F extends A{constructor(e,t,a){super(t,a),this.text=e}}class L extends A{constructor(e,t,a){super(t,a),this.date=e}}class I extends A{constructor(e,t,a,n){super(a,n),this.leftText=e,this.rightText=t}}function O(e,t){const{textColor:a,backgroundColor:n,text:i,date:o,leftText:s,rightText:r}=t;let l=e.addStack();if(l.size=new Size(0,16),l.backgroundColor=n,l.cornerRadius=8,o){l.addSpacer();const e=l.addDate(o);l.addSpacer(),e.centerAlignText(),e.applyTimerStyle(),c(e,.1,a)}else if(i){l.addSpacer();const e=l.addText(i);l.addSpacer(),c(e,.8,a)}else if(s&&r){l.addSpacer(8);const e=l.addText(s);l.addSpacer();const t=l.addText(r);l.addSpacer(8),c(e,.8,a),c(t,.8,a)}else{console.warn(`invalid tokenOption: ${JSON.stringify(t)}`),l.addSpacer();const e=l.addText("");l.addSpacer(),c(e,.8,a)}function c(e,t,a){const n=Font.semiboldSystemFont(14);e.lineLimit=1,e.font=n,e.minimumScaleFactor=t,a&&(e.textColor=a)}return l}function P(e,t,a,n){for(const i of t){const t=e.addStack();t.size=new Size(e.size.width,0),t.addSpacer(a),O(t,i),t.addSpacer(n)}}class M{constructor(e,t,a){this.date=e,this.symbolName=t,this.glyph=a}}function U(e,t){const a=e.addStack();a.centerAlignContent(),a.addSpacer(4);const{date:n,symbolName:i,glyph:o}=t;if(i){let e=SFSymbol.named(i),t=a.addImage(e.image);const n=10;t.imageSize=new Size(n,n),t.tintColor=Color.dynamic(new Color("#000000",1),new Color("#ffffff",1))}else a.addText(o).font=_;let s=a.addStack().addText(` @ ${T((r=n).getHours())}:${T(r.getMinutes())}`);var r;s.font=_,s.lineLimit=1;let l=a.addStack(),c=l.addText(" in ");c.font=_,c.lineLimit=1;let u=l.addDate(n);return u.font=_,u.lineLimit=1,u.applyTimerStyle(),a}function E(e,t){e.addSpacer();const a=e.addStack();return a.size=new Size(0,t),a.setPadding(0,-8,0,-8),a}function K(e,t){e.addSpacer();const a=e.addStack();return a.size=new Size(t,0),a}function J(e,t){e.addSpacer();const a=e.addStack();return a.size=new Size(t,t),a}class W extends e.Base{constructor(e){super(e),this.name="torn",this.version="0.3.3",this.desc=`版本 ${this.version}`,this.settingsURL=`https://cdn.jsdelivr.net/gh/Fitzmaz/TornWidget@${this.version}/dist/settings.html`,this.track("run")}defaultSettings(){const e=[{text:"YATA",value:"yata"},{text:"LootRangers",value:"lzpt"}],t=[{text:"bazaarcustomers",value:"bazaarcustomers"},{text:"bazaarsales",value:"bazaarsales"},{text:"bazaarprofit",value:"bazaarprofit"},{text:"useractivity",value:"useractivity"},{text:"activestreak",value:"activestreak"},{text:"bestactivestreak",value:"bestactivestreak"},{text:"itemsbought",value:"itemsbought"},{text:"pointsbought",value:"pointsbought"},{text:"itemsboughtabroad",value:"itemsboughtabroad"},{text:"moneyinvested",value:"moneyinvested"},{text:"investedprofit",value:"investedprofit"},{text:"weaponsbought",value:"weaponsbought"},{text:"trades",value:"trades"},{text:"itemssent",value:"itemssent"},{text:"auctionswon",value:"auctionswon"},{text:"auctionsells",value:"auctionsells"},{text:"pointssold",value:"pointssold"},{text:"attackswon",value:"attackswon"},{text:"attackslost",value:"attackslost"},{text:"attacksdraw",value:"attacksdraw"},{text:"bestkillstreak",value:"bestkillstreak"},{text:"killstreak",value:"killstreak"},{text:"moneymugged",value:"moneymugged"},{text:"attacksstealthed",value:"attacksstealthed"},{text:"attackhits",value:"attackhits"},{text:"attackmisses",value:"attackmisses"},{text:"attackdamage",value:"attackdamage"},{text:"attackcriticalhits",value:"attackcriticalhits"},{text:"respectforfaction",value:"respectforfaction"},{text:"onehitkills",value:"onehitkills"},{text:"defendswon",value:"defendswon"},{text:"defendslost",value:"defendslost"},{text:"defendsstalemated",value:"defendsstalemated"},{text:"bestdamage",value:"bestdamage"},{text:"roundsfired",value:"roundsfired"},{text:"yourunaway",value:"yourunaway"},{text:"theyrunaway",value:"theyrunaway"},{text:"highestbeaten",value:"highestbeaten"},{text:"peoplebusted",value:"peoplebusted"},{text:"failedbusts",value:"failedbusts"},{text:"peoplebought",value:"peoplebought"},{text:"peopleboughtspent",value:"peopleboughtspent"},{text:"virusescoded",value:"virusescoded"},{text:"cityfinds",value:"cityfinds"},{text:"traveltimes",value:"traveltimes"},{text:"bountiesplaced",value:"bountiesplaced"},{text:"bountiesreceived",value:"bountiesreceived"},{text:"bountiescollected",value:"bountiescollected"},{text:"totalbountyreward",value:"totalbountyreward"},{text:"revives",value:"revives"},{text:"revivesreceived",value:"revivesreceived"},{text:"medicalitemsused",value:"medicalitemsused"},{text:"statenhancersused",value:"statenhancersused"},{text:"trainsreceived",value:"trainsreceived"},{text:"totalbountyspent",value:"totalbountyspent"},{text:"drugsused",value:"drugsused"},{text:"overdosed",value:"overdosed"},{text:"meritsbought",value:"meritsbought"},{text:"personalsplaced",value:"personalsplaced"},{text:"classifiedadsplaced",value:"classifiedadsplaced"},{text:"mailssent",value:"mailssent"},{text:"friendmailssent",value:"friendmailssent"},{text:"factionmailssent",value:"factionmailssent"},{text:"companymailssent",value:"companymailssent"},{text:"spousemailssent",value:"spousemailssent"},{text:"largestmug",value:"largestmug"},{text:"cantaken",value:"cantaken"},{text:"exttaken",value:"exttaken"},{text:"kettaken",value:"kettaken"},{text:"lsdtaken",value:"lsdtaken"},{text:"opitaken",value:"opitaken"},{text:"shrtaken",value:"shrtaken"},{text:"spetaken",value:"spetaken"},{text:"pcptaken",value:"pcptaken"},{text:"xantaken",value:"xantaken"},{text:"victaken",value:"victaken"},{text:"chahits",value:"chahits"},{text:"heahits",value:"heahits"},{text:"axehits",value:"axehits"},{text:"grehits",value:"grehits"},{text:"machits",value:"machits"},{text:"pishits",value:"pishits"},{text:"rifhits",value:"rifhits"},{text:"shohits",value:"shohits"},{text:"smghits",value:"smghits"},{text:"piehits",value:"piehits"},{text:"slahits",value:"slahits"},{text:"argtravel",value:"argtravel"},{text:"mextravel",value:"mextravel"},{text:"dubtravel",value:"dubtravel"},{text:"hawtravel",value:"hawtravel"},{text:"japtravel",value:"japtravel"},{text:"lontravel",value:"lontravel"},{text:"soutravel",value:"soutravel"},{text:"switravel",value:"switravel"},{text:"chitravel",value:"chitravel"},{text:"cantravel",value:"cantravel"},{text:"dumpfinds",value:"dumpfinds"},{text:"dumpsearches",value:"dumpsearches"},{text:"itemsdumped",value:"itemsdumped"},{text:"daysbeendonator",value:"daysbeendonator"},{text:"caytravel",value:"caytravel"},{text:"jailed",value:"jailed"},{text:"hospital",value:"hospital"},{text:"attacksassisted",value:"attacksassisted"},{text:"bloodwithdrawn",value:"bloodwithdrawn"},{text:"networth",value:"networth"},{text:"missionscompleted",value:"missionscompleted"},{text:"contractscompleted",value:"contractscompleted"},{text:"dukecontractscompleted",value:"dukecontractscompleted"},{text:"missioncreditsearned",value:"missioncreditsearned"},{text:"consumablesused",value:"consumablesused"},{text:"candyused",value:"candyused"},{text:"alcoholused",value:"alcoholused"},{text:"energydrinkused",value:"energydrinkused"},{text:"nerverefills",value:"nerverefills"},{text:"unarmoredwon",value:"unarmoredwon"},{text:"h2hhits",value:"h2hhits"},{text:"organisedcrimes",value:"organisedcrimes"},{text:"territorytime",value:"territorytime"},{text:"territoryjoins",value:"territoryjoins"},{text:"stockpayouts",value:"stockpayouts"},{text:"stockprofits",value:"stockprofits"},{text:"stocklosses",value:"stocklosses"},{text:"stockfees",value:"stockfees"},{text:"arrestsmade",value:"arrestsmade"},{text:"tokenrefills",value:"tokenrefills"},{text:"booksread",value:"booksread"},{text:"traveltime",value:"traveltime"},{text:"boostersused",value:"boostersused"},{text:"rehabs",value:"rehabs"},{text:"rehabcost",value:"rehabcost"},{text:"awards",value:"awards"},{text:"receivedbountyvalue",value:"receivedbountyvalue"},{text:"networthpending",value:"networthpending"},{text:"networthwallet",value:"networthwallet"},{text:"networthbank",value:"networthbank"},{text:"networthpoints",value:"networthpoints"},{text:"networthcayman",value:"networthcayman"},{text:"networthvault",value:"networthvault"},{text:"networthpiggybank",value:"networthpiggybank"},{text:"networthitems",value:"networthitems"},{text:"networthdisplaycase",value:"networthdisplaycase"},{text:"networthbazaar",value:"networthbazaar"},{text:"networthproperties",value:"networthproperties"},{text:"networthstockmarket",value:"networthstockmarket"},{text:"networthitemmarket",value:"networthitemmarket"},{text:"networthauctionhouse",value:"networthauctionhouse"},{text:"networthcompany",value:"networthcompany"},{text:"networthbookie",value:"networthbookie"},{text:"networthenlistedcars",value:"networthenlistedcars"},{text:"networthloan",value:"networthloan"},{text:"networthunpaidfees",value:"networthunpaidfees"},{text:"racingskill",value:"racingskill"},{text:"raceswon",value:"raceswon"},{text:"racesentered",value:"racesentered"},{text:"racingpointsearned",value:"racingpointsearned"},{text:"specialammoused",value:"specialammoused"},{text:"cityitemsbought",value:"cityitemsbought"},{text:"hollowammoused",value:"hollowammoused"},{text:"tracerammoused",value:"tracerammoused"},{text:"piercingammoused",value:"piercingammoused"},{text:"incendiaryammoused",value:"incendiaryammoused"},{text:"attackswonabroad",value:"attackswonabroad"},{text:"defendslostabroad",value:"defendslostabroad"},{text:"retals",value:"retals"},{text:"elo",value:"elo"},{text:"strength",value:"strength"},{text:"defense",value:"defense"},{text:"speed",value:"speed"},{text:"dexterity",value:"dexterity"},{text:"totalstats",value:"totalstats"},{text:"manuallabor",value:"manuallabor"},{text:"intelligence",value:"intelligence"},{text:"endurance",value:"endurance"},{text:"totalworkingstats",value:"totalworkingstats"},{text:"jobpointsused",value:"jobpointsused"},{text:"reviveskill",value:"reviveskill"},{text:"itemslooted",value:"itemslooted"},{text:"refills",value:"refills"}];return{"notification.bars":!0,"notification.travel":!0,"notification.racing":!0,"notification.hospital":!0,"notification.drug":!0,"notification.booster":!0,"notification.medical":!0,"notification.npcloot":!0,"npcloot.services":{items:e,select:e[1]},"npcloot.duke":!0,"npcloot.leslie":!0,"npcloot.jimmy":!1,"npcloot.fernando":!0,"npcloot.tiny":!0,"npcloot.bunny":!1,"customslot.1":"","customslot.2":{items:t,select:null},"customslot.3":"","customslot.4":{items:t,select:null}}}updateURL(e="0"){return`https://cdn.jsdelivr.net/gh/Fitzmaz/TornWidget@${e}/dist`}track(e,a){const n="PlayerIDKey";a?(t.set(n,a),super.track(e,a)):t.get(n)&&super.track(e,a)}async render(){let e,t,a,n=this.arg;if("string"==typeof n&&n.length>0){const i=`https://api.torn.com/user/?selections=timestamp,basic,travel,cooldowns,bars,money,education,refills,icons,personalstats&key=${n}&comment=TornWidget`;e=await this.httpGet(i,!0,!1),t=await this.getPIDaysLeft(n),a=await this.getDrugAddictionPoints(n).catch((e=>{console.log(`Get addiction failed. ${e}`)}))}else e={timestamp:1615639666,level:25,gender:"Male",player_id:1,name:"microdust",server_time:1615639666,points:36,cayman_bank:0,vault_amount:0,daily_networth:5379662754,money_onhand:600293,education_current:61,education_timeleft:1545972,status:{description:"Traveling to United Kingdom",details:"",state:"Traveling",color:"blue",until:0},travel:{destination:"United Kingdom",timestamp:1615644140,departed:1615637300,time_left:4474},cooldowns:{drug:27118,medical:17393,booster:13236},happy:{current:4938,maximum:5025,increment:5,interval:900,ticktime:734,fulltime:16034},life:{current:685,maximum:1181,increment:70,interval:300,ticktime:134,fulltime:2234},energy:{current:30,maximum:150,increment:5,interval:600,ticktime:134,fulltime:13934},nerve:{current:15,maximum:61,increment:1,interval:300,ticktime:134,fulltime:13634},chain:{current:0,maximum:1e4,timeout:0,modifier:1,cooldown:0},city_bank:{amount:2436e6,time_left:6732555},education_completed:[14,18,19,20,34,43,44,45,46,47,48,49,50,51,52,54,112,113,126,127],refills:{energy_refill_used:!0,nerve_refill_used:!1,token_refill_used:!1,special_refills_available:0},icons:{icon6:"Male",icon4:"Subscriber - Donator status: 92 days - Subscriber until: 24/08/21",icon8:"Married - To Trefor",icon29:"Bank Investment - Current bank investment worth $3,639,000,000 - 60 days, 23 hours, 34 minutes and 39 seconds",icon27:"Company - Chandler of Lead Farmers (Candle Shop)",icon9:"Faction - Karajan of November Chopin",icon19:"Education - Currently completing the Bachelor of Psychological Sciences course - 26 days, 9 hours, 9 minutes and 58 seconds",icon38:"Stock Market - You own shares in the stock market",icon85:"Organized Crime - Planned Robbery - 3 days, 15 hours, 47 minutes and 0 seconds",icon39:"Booster Cooldown - 01:24:28 / 24:00:00",icon52:"Drug Cooldown - Under the influence of Xanax - 03:03:50 ",icon78:"Property Upkeep war - $21,755,000 is due in property upkeep",icon17:"Racing - Waiting for a race to start - 00:58:29"}},e.timestamp=Math.floor(Date.now()/1e3),t=999;const{player_id:i}=e;i&&this.track("render",i);const o=await this.parseData(e);o.pi=60*t*60*24,a&&(o.dap=a);const s=new ListWidget;switch(this.widgetFamily){case"large":await this.renderLarge(s,o);break;case"medium":const e=s.addStack();await this.renderMedium(e,o);break;default:this.renderSmall(s,o)}return s}renderSmall(e,t){let a=[];switch(t.status){case"Abroad":a.push(new F("abroad",new Color("#ececec",1),Color.blue()));break;case c:a.push(new F("flying",new Color("#ececec",1),Color.purple()));break;case l:const e=t.DataKeyDischargeDate;a.push(new L(e,new Color("#ececec",1),Color.red()));break;default:a.push(new F("okay",new Color("#ececec",1),Color.green()))}for(const e of[u,d]){const n={energy:"#4d7c1e",nerve:"#b3382c"},i=t[e];a.push(new F(`${i.current}/${i.maximum}`,new Color("#ececec",1),new Color(n[e],1)))}t.dap?a.push(new F(`${t.dap}`,new Color("#ececec",1),new Color("#6cadde",1))):a.push(new F(`refill:${t["refills.energy"]}`,new Color("#ececec",1),new Color("#6cadde",1)));let n=[];for(const e of[f,w,"oc","pi"]){if(!t[e])continue;const a={[f]:"🏦",[w]:"🎓",oc:"OC",pi:" PI"};let i,o=N(t[e]);i=o?999===o.value?" ∞":`${o.value}${o.unit[0]}`:"now",n.push(new I(a[e],i,null,C))}let i=[];const o=[m,p,h,v,g];for(const e of o){if(!t[e])continue;let a=t[e];const n=k[e],o=S[e];i.push(new M(a,n,o))}let s=E(e,D),r=J(s,D),x=J(s,D);s.addSpacer();let y=E(e,D);y.addSpacer();let b=y.addStack();b.size=new Size(j,D),b.cornerRadius=8,b.backgroundColor=C,y.addSpacer(),e.addSpacer(),r.layoutVertically(),r.addSpacer(),P(r,a,3,0),r.addSpacer(),x.layoutVertically(),x.addSpacer(),P(x,n,0,4),x.addSpacer(),b.layoutVertically();for(const e of i)U(b,e)}async renderMedium(e,t){const a=K(e,j);a.layoutVertically();const n=K(e,j);n.layoutVertically(),e.addSpacer(),this.renderSmall(a,t);let i=[];i.push(new F("refills",null,C));for(const e of[x,y,b]){if(void 0===t[e])continue;const a={[x]:"ener",[y]:"nerv",[b]:"toke"};i.push(new F(`${a[e]}:${t[e]}`,null,C))}let l=[];for(const e of["customslot.1","customslot.2","customslot.3","customslot.4"]){if(!t[e]){l.push(new F(" ",null,C));continue}let a;a=t[e]>1e6?s(o(t[e],3)):`${t[e]}`,l.push(new F(a,null,C))}const c=this.settings["npcloot.services"].select.value,u=r[c],d=await u();let m=[];if(d){for(const e in d.npcs){const t=d.npcs[e],a=`torn.npc.${e}`;if(this.settings["notification.npcloot"]||await Notification.removePending([a]),!this.settings[`npcloot.${t.name.toLowerCase()}`])continue;if(!t.hosp_out)continue;const n=new Date(1e3*(t.hosp_out+12600)),i=t.glyph;m.push(new M(n,null,i)),this.settings["notification.npcloot"]&&await z({identifier:a,title:"Torn NPC",body:`Loot ${t.name} in 5 minutes`,openURL:`alook://www.torn.com/loader2.php?sid=getInAttack&user2ID=${e}`},new Date(n.getTime()-3e5))}if(d.planned){const e=new Date(1e3*d.planned);m.push(new M(e,null,"LR"))}}let p=E(n,D),h=J(p,D),v=J(p,D);p.addSpacer();let g=E(n,D);g.addSpacer();let f=g.addStack();f.size=new Size(j,D),f.cornerRadius=8,f.backgroundColor=C,g.addSpacer(),n.addSpacer(),h.layoutVertically(),h.addSpacer(),P(h,i,3,0),h.addSpacer(),v.layoutVertically(),v.addSpacer(),P(v,l,0,4),v.addSpacer(),f.layoutVertically();for(const e of m)U(f,e)}async renderLarge(e,t){const a=E(e,j);a.layoutHorizontally(),E(e,j).layoutHorizontally(),e.addSpacer(),await this.renderMedium(a,t)}async fetchAPI(e,t){t.comment="TornWidget";let a=`https://api.torn.com/${e}?${Object.keys(t).map((e=>`${e}=${t[e]}`)).join("&")}`;const n=await this.httpGet(a,!0,!1);if(!n)throw new Error("fetchAPI failed");if(n.error){let{code:e,error:t}=n.error;throw new Error(`API error ${e} ${t}`)}return n}async getPIDaysLeft(e){const a="PropertyDataKey",n=t.getJSON(a);if(n&&Date.now()-n.timestamp<864e5)return n.days;const i=await this.fetchAPI("property",{selections:"property",key:e});if(!(i&&i.property&&i.property.property_type&&i.property.rented))return void console.warn("invalid property data");const{property_type:o,rented:s}=i.property;let r;return 13===o&&(r="string"==typeof s.days_left?999:s.days_left),t.setJSON(a,{days:r,timestamp:Date.now()}),r}async getDrugAddictionPoints(e){const t=await this.fetchAPI("user",{selections:"log",cat:"61",key:e}).catch((e=>{throw e})),a=Object.values(t.log).sort(((e,t)=>t.timestamp-e.timestamp)),n=a.filter((e=>6005===e.log)),o=a.filter((e=>6005!==e.log));console.log("drug addiction points resolving.");const s=i(n,o);if(!s.length)throw new Error("createTableRows return empty");const{points:r}=s.pop();return console.log(`drug addiction points resolved ${r}`),r}async parseData(e){let{timestamp:t,cooldowns:a,status:n,travel:i}=e,{energy:o,nerve:s,happy:r,life:m,chain:p}=e;const f="torn.bars";this.settings["notification.bars"]&&o?await z({identifier:f,title:"Torn Bars",body:`Energy has reached ${o.maximum}/${o.maximum}`},R(t,o.fulltime)):await Notification.removePending([f]);let{city_bank:w,education_timeleft:x}=e,y={timestamp:t,status:n.state,[u]:o,[d]:s};if(n.state===c){let{destination:e,time_left:a}=i,n=R(t,a);y.travel=n;const o="torn.travel";this.settings["notification.travel"]?await z({identifier:o,title:"Torn Travel",body:`Arriving at ${e}`},new Date(n.getTime()-15e3)):await Notification.removePending([o])}const b="torn.hospital";if(n.state===l){let e=new Date(1e3*n.until);y.DataKeyDischargeDate=e,this.settings["notification.hospital"]?await z({identifier:b,title:"Torn Hospital",body:"Leaving hospital in a minute"},new Date(e.getTime()-6e4)):await Notification.removePending([b])}else await Notification.removePending([b]);const k=[h,v,g];for(const e of k){if(0===a[e])continue;let n=R(t,a[e]);y[e]=n;const i=`torn.cooldowns.${e}`;this.settings[`notification.${e}`]?await z({identifier:`torn.cooldowns.${e}`,title:"Torn Cooldowns",body:`Here is your ${e} cooldown reminder!`},n):await Notification.removePending([i])}w&&void 0!==w.time_left&&(y.bank=w.time_left),void 0!==x&&(y.education=x);let{refills:S}=e;if(S){const{energy_refill_used:e,nerve_refill_used:t,token_refill_used:a,special_refills_available:n}=S;if(void 0!==e&&void 0!==n){let t=Number(n);e||(t+=1),y["refills.energy"]=t}void 0!==t&&(y["refills.nerve"]=t?0:1),void 0!==a&&(y["refills.token"]=a?0:1)}let{icons:_}=e;if(_.icon85?y.oc=C(_.icon85):y.oc=0,_.icon17){let e=_.icon17.toLowerCase().includes("wait")?$:"RacingStatusRacing",a=C(_.icon17);if(a){const n=R(t,a);y.racing=n;const i="torn.racing";this.settings["notification.racing"]?await z({identifier:i,title:"Torn Racing",body:"The race has "+(e===$?"started":"finished")},n):await Notification.removePending([i])}}else _.icon18,y.racing=null;function C(e){let t=e.match(/\d+ \w+/g);if(null!==t&&t.length>0)return t.reduce(((e,t)=>{let a=t.split(" "),n=Number(a[0]),i=a[1];return"days"===i?e+60*n*60*24:"hours"===i?e+60*n*60:"minutes"===i?e+60*n:"seconds"===i?e+n:e}),0);if(t=e.match(/\d{2}:\d{2}:\d{2}/g),null!==t&&t.length>0){let e=t[0].split(":");return 3600*e[0]+60*e[1]+Number(e[2])}return 0}const{personalstats:T}=e;if(T){const e=this.settings["customslot.1"],t=this.settings["customslot.2"],a=this.settings["customslot.3"],n=this.settings["customslot.4"];e&&(y["customslot.1"]=e),t&&t.select&&(y["customslot.2"]=T[t.select.value]),a&&(y["customslot.3"]=a),n&&n.select&&(y["customslot.4"]=T[n.select.value])}return y}}async function G(){await(0,e.Running)(W)}})(),Scriptable=n})();
await Scriptable.run();